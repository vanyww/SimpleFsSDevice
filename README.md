# Файловая система SimpleFs

SimpleFs - это простая журналируемая файловая система, развивающая идеи пакета `X-CUBE-EEPROM`.
Она реализована в виде модуля SDevice и ставит своей целью обеспечение консистентности данных в случае возникновения ошибок памяти.

## Зависимости

* [SDeviceCore](https://gitlab.dnouglublenie.ru/nonius/embeddedfirmware/embeddedcommon/forks/cexception.git)
* [TableCrcSDevice](https://gitlab.dnouglublenie.ru/nonius/embeddedfirmware/embeddedcommon/tablecrcsdevice.git)

## Принцип работы

Файловая система использует два сектора памяти, которые должен предоставить пользователь. При записи (или удалении, так как оно воспринимается как особая запись) значения, старая его версия не удаляется до момента переноса.
> Перенос - это процесс копирования последних версий файлов с текущего сектора на другой с последующим форматированием текущего.

Такое поведение позволяет откатиться к старому значению файла в случае, если более новые окажутся повреждены. Сам процесс переноса также снабжен защитой от внезапного завершения работы, для чего используются служебные заголовочные блоки. Также подобный алгоритм позволяет сильно увеличить ресурс FLASH-памяти.

Для контроля консистентности значений файлов и служебных блоков используются алгоритмы CRC16 и CRC8 соответственно.

При этом, в случае записи версий одного файла с разными размерами, проблемой становится его чтений: последняя записанная версия может оказаться поврежденной, а предоставленный пользователем буфер недостаточным для чтения предыдущих версий. Для решения подобных ситуаций реализована функция `SimpleFsSDeviceGetMaxFileSize`, возвращающая наибольший размер файла с переданным ей идентификатором. Выделение буфера соответствующего размера позволит гарантировать возможность чтения в него любой версии данного файла.

> Вместо текстовых имен файлов, в данной файловой системе используются целочисленные их идентификаторы.
